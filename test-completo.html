<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Teste Completo - Sincronizador WC</title>
    <link rel="stylesheet" href="admin/css/admin-styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body style="background: #f1f1f1; padding: 20px; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif;">
    <div class="wrap sincronizador-wc-wrap" style="background: white; max-width: 1200px; margin: 0 auto; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <h1>üß™ Teste Completo do Sistema</h1>
        
        <!-- Simula√ß√£o da p√°gina de lojistas -->
        <div class="card" style="margin-bottom: 30px;">
            <h2>üë• Lojistas (Simula√ß√£o)</h2>
            <p>Esta se√ß√£o simula a p√°gina de lojistas do WordPress com bot√µes funcionais:</p>
            
            <table class="wp-list-table widefat fixed striped" style="margin-top: 15px;">
                <thead>
                    <tr>
                        <th>Nome da Loja</th>
                        <th>URL</th>
                        <th>Status</th>
                        <th>√öltima Sync</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Loja Teste 1</strong></td>
                        <td><a href="https://exemplo1.com" target="_blank">https://exemplo1.com</a></td>
                        <td><span class="status-ativo">Ativo</span></td>
                        <td>Nunca</td>
                        <td>
                            <form method="post" style="display:inline-block; margin-right: 5px;">
                                <input type="hidden" name="action" value="sync_produtos">
                                <input type="hidden" name="lojista_id" value="1">
                                <button type="submit" class="button button-primary button-small btn-sincronizar" data-lojista="1" title="Sincronizar todos os produtos">üîÑ Sincronizar</button>
                            </form>
                            <button class="button button-small">‚úèÔ∏è Editar</button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Loja Teste 2</strong></td>
                        <td><a href="https://exemplo2.com" target="_blank">https://exemplo2.com</a></td>
                        <td><span class="status-ativo">Ativo</span></td>
                        <td>Nunca</td>
                        <td>
                            <form method="post" style="display:inline-block; margin-right: 5px;">
                                <input type="hidden" name="action" value="sync_produtos">
                                <input type="hidden" name="lojista_id" value="2">
                                <button type="submit" class="button button-primary button-small btn-sincronizar" data-lojista="2" title="Sincronizar todos os produtos">üîÑ Sincronizar</button>
                            </form>
                            <button class="button button-small">‚úèÔ∏è Editar</button>
                        </td>
                    </tr>
                    <tr>
                        <td><strong>Loja Teste 3</strong></td>
                        <td><a href="https://exemplo3.com" target="_blank">https://exemplo3.com</a></td>
                        <td><span class="status-inativo">Inativo</span></td>
                        <td>Nunca</td>
                        <td>
                            <form method="post" style="display:inline-block; margin-right: 5px;">
                                <input type="hidden" name="action" value="sync_produtos">
                                <input type="hidden" name="lojista_id" value="3">
                                <button type="submit" class="button button-primary button-small btn-sincronizar" data-lojista="3" title="Sincronizar todos os produtos">üîÑ Sincronizar</button>
                            </form>
                            <button class="button button-small">‚úèÔ∏è Editar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Simula√ß√£o da p√°gina de importa√ß√£o -->
        <div class="card" style="margin-bottom: 30px;">
            <h2>üì¶ Importa√ß√£o de Produtos (Simula√ß√£o)</h2>
            
            <div id="lojista-selection" style="margin-bottom: 20px;">
                <select id="lojista_destino" class="regular-text">
                    <option value="">Selecione o lojista...</option>
                    <option value="1">Loja Teste 1 (https://exemplo1.com) - Status: Ativo</option>
                    <option value="2">Loja Teste 2 (https://exemplo2.com) - Status: Ativo</option>
                    <option value="3">Loja Teste 3 (https://exemplo3.com) - Status: Inativo</option>
                </select>
                <button type="button" id="btn-validar-lojista" class="button button-primary" disabled>
                    üîç Validar Conex√£o
                </button>
            </div>
            
            <div id="validacao-status" style="display: none; margin-bottom: 15px;"></div>
            
            <button type="button" id="btn-carregar-produtos" class="button button-secondary" disabled>
                üìã Carregar Produtos
            </button>
            
            <div id="produtos-section" style="display: none; margin-top: 20px;">
                <h3>Produtos com Pagina√ß√£o</h3>
                <div id="produtos-resumo"></div>
                <div id="produtos-grid"></div>
                <div id="produtos-pagination"></div>
            </div>
        </div>
        
        <!-- Log de Debug -->
        <div class="card">
            <h2>üîç Debug Console</h2>
            <div id="debug-log" style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                <div>üí° Sistema carregado. Aguardando intera√ß√µes...</div>
            </div>
        </div>
    </div>

    <script>
        // Simular o objeto SincronizadorWC do WordPress
        window.SincronizadorWC = {
            ajaxurl: '#fake-ajax-endpoint',
            nonce: 'fake-nonce-123',
            strings: {
                confirmDelete: 'Tem certeza que deseja remover?',
                loading: 'Carregando...',
                error: 'Erro na requisi√ß√£o',
                success: 'Opera√ß√£o realizada com sucesso'
            },
            showNotice: function(message) { console.log('NOTICE:', message); },
            formatPrice: function(price) { return parseFloat(price || 0).toFixed(2).replace(".", ","); }
        };
        
        // Fun√ß√£o de log
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#3498db',
                success: '#27ae60', 
                error: '#e74c3c',
                warning: '#f39c12'
            };
            
            const logEntry = `<div style="color: ${colors[type]}; margin: 2px 0;">[${timestamp}] ${message}</div>`;
            $('#debug-log').append(logEntry);
            $('#debug-log').scrollTop($('#debug-log')[0].scrollHeight);
        }
        
        // Simular produtos de demonstra√ß√£o com mais variedade
        const produtosDemonstracao = [
            { id: 1, nome: 'üì± Smartphone Galaxy X1', sku: 'SMART-001', preco: '899.90', preco_promocional: '799.90', estoque: 15, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/3498db/FFFFFF?text=üì±', status: 'ativo' },
            { id: 2, nome: 'üëï Camiseta B√°sica Azul', sku: 'CAM-001', preco: '29.90', preco_promocional: '', estoque: 100, categoria: 'Roupas', imagem: 'https://via.placeholder.com/80x80/2ecc71/FFFFFF?text=üëï', status: 'ativo' },
            { id: 3, nome: 'üëü T√™nis Esportivo Nike', sku: 'TEN-001', preco: '299.90', preco_promocional: '249.90', estoque: 25, categoria: 'Cal√ßados', imagem: 'https://via.placeholder.com/80x80/e74c3c/FFFFFF?text=üëü', status: 'ativo' },
            { id: 4, nome: 'üéß Fone Bluetooth Premium', sku: 'FONE-001', preco: '199.90', preco_promocional: '', estoque: 40, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/9b59b6/FFFFFF?text=üéß', status: 'ativo' },
            { id: 5, nome: 'üëñ Cal√ßa Jeans Masculina', sku: 'CAL-001', preco: '89.90', preco_promocional: '79.90', estoque: 60, categoria: 'Roupas', imagem: 'https://via.placeholder.com/80x80/34495e/FFFFFF?text=üëñ', status: 'ativo' },
            { id: 6, nome: '‚åö Rel√≥gio Smartwatch', sku: 'REL-001', preco: '399.90', preco_promocional: '349.90', estoque: 20, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/1abc9c/FFFFFF?text=‚åö', status: 'ativo' },
            { id: 7, nome: 'üéí Mochila Executiva', sku: 'MOC-001', preco: '129.90', preco_promocional: '', estoque: 35, categoria: 'Acess√≥rios', imagem: 'https://via.placeholder.com/80x80/f39c12/FFFFFF?text=üéí', status: 'ativo' },
            { id: 8, nome: 'üíª Notebook Gamer RGB', sku: 'NOTE-001', preco: '2999.90', preco_promocional: '2699.90', estoque: 8, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/8e44ad/FFFFFF?text=üíª', status: 'ativo' },
            { id: 9, nome: 'üï∂Ô∏è √ìculos de Sol Ray-Ban', sku: 'OCU-001', preco: '459.90', preco_promocional: '', estoque: 12, categoria: 'Acess√≥rios', imagem: 'https://via.placeholder.com/80x80/2c3e50/FFFFFF?text=üï∂Ô∏è', status: 'ativo' },
            { id: 10, nome: 'üëó Vestido Floral Ver√£o', sku: 'VES-001', preco: '89.90', preco_promocional: '69.90', estoque: 45, categoria: 'Roupas', imagem: 'https://via.placeholder.com/80x80/e91e63/FFFFFF?text=üëó', status: 'ativo' },
            { id: 11, nome: 'üñ±Ô∏è Mouse Gamer RGB', sku: 'MOU-001', preco: '89.90', preco_promocional: '', estoque: 55, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/ff5722/FFFFFF?text=üñ±Ô∏è', status: 'ativo' },
            { id: 12, nome: 'üß¢ Bon√© Aba Reta NY', sku: 'BON-001', preco: '49.90', preco_promocional: '39.90', estoque: 80, categoria: 'Acess√≥rios', imagem: 'https://via.placeholder.com/80x80/607d8b/FFFFFF?text=üß¢', status: 'ativo' },
            { id: 13, nome: 'üèÄ Bola de Basquete Oficial', sku: 'BOL-001', preco: '89.90', preco_promocional: '', estoque: 25, categoria: 'Esportes', imagem: 'https://via.placeholder.com/80x80/ff9800/FFFFFF?text=üèÄ', status: 'ativo' },
            { id: 14, nome: 'üéÆ Controle Wireless PS5', sku: 'CON-001', preco: '299.90', preco_promocional: '279.90', estoque: 18, categoria: 'Eletr√¥nicos', imagem: 'https://via.placeholder.com/80x80/3f51b5/FFFFFF?text=üéÆ', status: 'ativo' },
            { id: 15, nome: 'üìö Kit Livros Programa√ß√£o', sku: 'LIV-001', preco: '199.90', preco_promocional: '', estoque: 30, categoria: 'Livros', imagem: 'https://via.placeholder.com/80x80/4caf50/FFFFFF?text=üìö', status: 'ativo' }
        ];
        
        // Implementa√ß√µes das fun√ß√µes que o JavaScript espera
        function mostrarModalProgresso() {
            addDebugLog('üöÄ Modal de progresso aberto', 'info');
            
            const modal = `
                <div id="modal-progresso" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Sincronizando Produtos</h3>
                        </div>
                        <div class="modal-body">
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                </div>
                                <div class="progress-text" id="progress-text">Iniciando sincroniza√ß√£o...</div>
                            </div>
                            <div class="sync-details" id="sync-details">
                                <div class="detail-item">
                                    <span>Produtos encontrados:</span>
                                    <span id="produtos-encontrados">0</span>
                                </div>
                                <div class="detail-item">
                                    <span>Produtos sincronizados:</span>
                                    <span id="produtos-sincronizados">0</span>
                                </div>
                                <div class="detail-item">
                                    <span>Produtos criados:</span>
                                    <span id="produtos-criados">0</span>
                                </div>
                                <div class="detail-item">
                                    <span>Produtos atualizados:</span>
                                    <span id="produtos-atualizados">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modal);
            $('#modal-progresso').fadeIn(300);
            
            // Simular progresso
            let progresso = 0;
            const interval = setInterval(() => {
                progresso += Math.random() * 15;
                if (progresso > 100) progresso = 100;
                
                $('#progress-fill').css('width', progresso + '%');
                $('#progress-text').text(`Sincronizando produtos... ${Math.floor(progresso)}%`);
                
                $('#produtos-encontrados').text(Math.floor(progresso / 7));
                $('#produtos-sincronizados').text(Math.floor(progresso / 10));
                $('#produtos-criados').text(Math.floor(progresso / 15));
                $('#produtos-atualizados').text(Math.floor(progresso / 20));
                
                if (progresso >= 100) {
                    clearInterval(interval);
                    $('#progress-text').text('Sincroniza√ß√£o conclu√≠da!');
                    setTimeout(() => {
                        fecharModalProgresso();
                        mostrarRelatorioSync({
                            produtos_sincronizados: Math.floor(Math.random() * 15) + 5,
                            produtos_criados: Math.floor(Math.random() * 8) + 2,
                            produtos_atualizados: Math.floor(Math.random() * 7) + 1,
                            erros: Math.floor(Math.random() * 2),
                            lojista: 'Loja Teste',
                            detalhes: 'Sincroniza√ß√£o realizada com sucesso!'
                        });
                    }, 2000);
                }
            }, 300);
        }
        
        function fecharModalProgresso() {
            $('#modal-progresso').fadeOut(300, function() {
                $(this).remove();
            });
            addDebugLog('‚ùå Modal de progresso fechado', 'info');
        }
        
        function mostrarRelatorioSync(dados) {
            addDebugLog(`‚úÖ Relat√≥rio: ${dados.produtos_sincronizados} produtos sincronizados`, 'success');
            
            const relatorio = `
                <div id="modal-relatorio" class="modal-overlay">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Relat√≥rio de Sincroniza√ß√£o</h3>
                            <button class="modal-close" onclick="$('#modal-relatorio').fadeOut(300, function(){ $(this).remove(); })">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="relatorio-resumo">
                                <div class="resumo-item success">
                                    <span class="resumo-numero">${dados.produtos_sincronizados}</span>
                                    <span class="resumo-label">Produtos Sincronizados</span>
                                </div>
                                <div class="resumo-item info">
                                    <span class="resumo-numero">${dados.produtos_criados || 0}</span>
                                    <span class="resumo-label">Produtos Criados</span>
                                </div>
                                <div class="resumo-item warning">
                                    <span class="resumo-numero">${dados.produtos_atualizados || 0}</span>
                                    <span class="resumo-label">Produtos Atualizados</span>
                                </div>
                                <div class="resumo-item error">
                                    <span class="resumo-numero">${dados.erros || 0}</span>
                                    <span class="resumo-label">Erros</span>
                                </div>
                            </div>
                            <div class="relatorio-detalhes">
                                ${dados.detalhes || 'Sincroniza√ß√£o conclu√≠da com sucesso!'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(relatorio);
            $('#modal-relatorio').fadeIn(300);
        }
        
        // Copiar a fun√ß√£o de pagina√ß√£o do arquivo real
        function renderProdutos(produtos) {
            const grid = $("#produtos-grid");
            const paginationContainer = $("#produtos-pagination");
            
            grid.empty();
            paginationContainer.empty();
            
            if (produtos.length === 0) {
                grid.html('<p class="text-center">Nenhum produto encontrado</p>');
                return;
            }
            
            addDebugLog(`üì¶ Renderizando ${produtos.length} produtos com pagina√ß√£o`, 'info');
            
            // Configura√ß√µes de pagina√ß√£o
            const produtosPorPagina = 6; // Menos produtos por p√°gina para testar pagina√ß√£o
            const totalPaginas = Math.ceil(produtos.length / produtosPorPagina);
            let paginaAtual = 1;
            
            function renderPagina(pagina) {
                grid.empty();
                
                const inicio = (pagina - 1) * produtosPorPagina;
                const fim = inicio + produtosPorPagina;
                const produtosPagina = produtos.slice(inicio, fim);
                
                addDebugLog(`üìÑ P√°gina ${pagina}: produtos ${inicio + 1}-${Math.min(fim, produtos.length)}`, 'info');
                
                produtosPagina.forEach(function(produto) {
                    const isDisabled = produto.status !== "ativo";
                    const precoFinal = produto.preco_promocional ? produto.preco_promocional : produto.preco;
                    const precoOriginal = produto.preco_promocional ? produto.preco : '';
                    
                    let precoHTML = `<span class="preco-atual">R$ ${window.SincronizadorWC.formatPrice(precoFinal)}</span>`;
                    if (precoOriginal) {
                        precoHTML += ` <del class="preco-original">R$ ${window.SincronizadorWC.formatPrice(precoOriginal)}</del>`;
                    }
                    
                    const card = $(`
                        <div class="produto-card ${isDisabled ? 'disabled' : ''}" 
                             data-categoria="${produto.categoria}" 
                             data-status="${produto.status}">
                            <div class="produto-checkbox">
                                <input type="checkbox" 
                                       name="produtos_selecionados[]" 
                                       value="${produto.id}" 
                                       id="produto_${produto.id}"
                                       ${isDisabled ? 'disabled' : ''}>
                            </div>
                            <div class="produto-imagem">
                                <img src="${produto.imagem}" 
                                     alt="${produto.nome}" 
                                     width="80" height="80">
                            </div>
                            <div class="produto-info">
                                <h4><label for="produto_${produto.id}">${produto.nome}</label></h4>
                                <p><strong>SKU:</strong> ${produto.sku}</p>
                                <p><strong>Categoria:</strong> ${produto.categoria}</p>
                                <p><strong>Pre√ßo:</strong> ${precoHTML}</p>
                                <p><strong>Estoque:</strong> ${produto.estoque} unidades</p>
                                <span class="produto-status status-${produto.status}">${produto.status}</span>
                            </div>
                        </div>
                    `);
                    
                    grid.append(card);
                });
                
                // Atualizar controles de pagina√ß√£o
                renderPaginationControls(pagina, totalPaginas);
            }
            
            function renderPaginationControls(pagina, total) {
                if (total <= 1) return;
                
                let paginationHTML = `
                    <div class="pagination-info">
                        Mostrando ${((pagina - 1) * produtosPorPagina) + 1}-${Math.min(pagina * produtosPorPagina, produtos.length)} de ${produtos.length} produtos
                    </div>
                    <div class="pagination-controls">
                `;
                
                // Bot√£o anterior
                if (pagina > 1) {
                    paginationHTML += `<button class="button pagination-btn" data-page="${pagina - 1}">‚Äπ Anterior</button>`;
                }
                
                // N√∫meros das p√°ginas
                for (let i = 1; i <= total; i++) {
                    if (i === pagina) {
                        paginationHTML += `<button class="button button-primary pagination-btn" data-page="${i}">${i}</button>`;
                    } else if (i === 1 || i === total || (i >= pagina - 2 && i <= pagina + 2)) {
                        paginationHTML += `<button class="button pagination-btn" data-page="${i}">${i}</button>`;
                    } else if (i === pagina - 3 || i === pagina + 3) {
                        paginationHTML += `<span class="pagination-dots">...</span>`;
                    }
                }
                
                // Bot√£o pr√≥ximo
                if (pagina < total) {
                    paginationHTML += `<button class="button pagination-btn" data-page="${pagina + 1}">Pr√≥ximo ‚Ä∫</button>`;
                }
                
                paginationHTML += '</div>';
                
                paginationContainer.html(paginationHTML);
                
                // Event listeners para pagina√ß√£o
                paginationContainer.find('.pagination-btn').on('click', function() {
                    const novaPagina = parseInt($(this).data('page'));
                    paginaAtual = novaPagina;
                    addDebugLog(`üìÑ Mudando para p√°gina ${novaPagina}`, 'info');
                    renderPagina(novaPagina);
                });
            }
            
            // Renderizar primeira p√°gina
            renderPagina(1);
            
            // Mostrar resumo
            $("#produtos-resumo").html(`
                <div class="produtos-summary">
                    <strong>üìä Resumo:</strong> 
                    ${produtos.length} produtos encontrados | 
                    ${produtos.filter(p => p.status === 'ativo').length} ativos | 
                    ${produtos.filter(p => p.preco_promocional).length} em promo√ß√£o
                </div>
            `);
        }
        
        // Event listeners espec√≠ficos do teste
        $(document).ready(function() {
            addDebugLog('üéØ Sistema de teste inicializado', 'success');
            
            // Simular mudan√ßa de lojista
            $('#lojista_destino').change(function() {
                const selectedValue = $(this).val();
                const selectedText = $(this).find('option:selected').text();
                
                if (selectedValue) {
                    addDebugLog(`üéØ Lojista selecionado: ${selectedValue} - ${selectedText}`, 'info');
                    $('#btn-validar-lojista').prop('disabled', false);
                } else {
                    $('#btn-validar-lojista').prop('disabled', true);
                    $('#btn-carregar-produtos').prop('disabled', true);
                    $('#validacao-status').hide();
                }
            });
            
            // Simular valida√ß√£o de lojista
            $('#btn-validar-lojista').click(function() {
                const lojistaId = $('#lojista_destino').val();
                addDebugLog(`üîç Validando lojista ${lojistaId}...`, 'info');
                
                $(this).prop('disabled', true).text('‚è≥ Validando...');
                
                setTimeout(() => {
                    $('#validacao-status').html(`
                        <div class="notice notice-success">
                            <p>‚úÖ Lojista validado! Conex√£o OK - WooCommerce vers√£o: 8.4.0</p>
                        </div>
                    `).show();
                    
                    $(this).prop('disabled', false).text('üîç Validar Conex√£o');
                    $('#btn-carregar-produtos').prop('disabled', false);
                    
                    addDebugLog('‚úÖ Lojista validado com sucesso', 'success');
                }, 2000);
            });
            
            // Simular carregamento de produtos
            $('#btn-carregar-produtos').click(function() {
                addDebugLog('üìã Carregando produtos da f√°brica...', 'info');
                
                $(this).prop('disabled', true).text('‚è≥ Carregando...');
                
                setTimeout(() => {
                    renderProdutos(produtosDemonstracao);
                    $('#produtos-section').show();
                    
                    $(this).prop('disabled', false).text('üìã Carregar Produtos');
                    addDebugLog(`‚úÖ ${produtosDemonstracao.length} produtos carregados com pagina√ß√£o`, 'success');
                }, 1500);
            });
            
            // Event listeners para sincroniza√ß√£o
            $(document).on('click', '.btn-sincronizar', function(e) {
                e.preventDefault();
                const lojista = $(this).data('lojista');
                addDebugLog(`üîÑ Iniciando sincroniza√ß√£o para lojista ${lojista}`, 'warning');
                
                mostrarModalProgresso();
            });
            
            // Interceptar formul√°rios
            $(document).on('submit', 'form', function(e) {
                const action = $(this).find('input[name="action"]').val();
                
                if (action === 'sync_produtos') {
                    e.preventDefault();
                    const lojistaId = $(this).find('input[name="lojista_id"]').val();
                    addDebugLog(`üìù Formul√°rio interceptado - Lojista ${lojistaId}`, 'warning');
                    
                    mostrarModalProgresso();
                }
            });
        });
    </script>
</body>
</html>
